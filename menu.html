<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
	<head>

		<title>
			Acorn Atom Archive Web Menu
		</title>

		<style type = "text/css">

			@font-face
			{
				font-family:	"atom_font";
				src:			url("./atom_font.eot");
				src:			url("./atom_font.eot?#iefix")				format("embedded-opentype"),
								url("./atom_font.woff")						format("woff"),
								url("./atom_font.ttf")						format("truetype"),
								url("./atom_font.svg#courier_newregular")	format("svg");
				font-weight:	normal;
				font-style:		normal;
			}

			body
			{
				border:			0px;
				margin:			0px;
				padding:		0px;
				font:			16px atom_font, Tahoma, "Lucida Console", monospace;
				color:			white;
			}

			button
			{
				width:			100px;
				height:			40px;
				line-height:	35px;
				font:			16px atom_font, Tahoma, "Lucida Console", monospace;
				margin:			2px;
			}

			img
			{
				padding:		4px;
			}

			h1, h2
			{
				font-weight:	normal;
				line-height:	16px;
				margin:			5px 0px;
			}

		</style>

	</head>
	<body>
		<table style = "width: 98%; margin: 1% 1%; background-color: silver;">
			<script type = "text/javascript" language = "JavaScript" src = "./archive_database.js"></script>
			<script type = "text/javascript">

				<!--

var aDSKs = [], bLocal = document.location.href.substr(0, 7).toLowerCase() == "file://", ARGV = new VARG_type();

function VARG_type()	// VARG (Variable ARGument) defaults
{
	this.filter = "";
}

function VARG_get(o)
{
	var js = self.location.search.substring(1);
	if (js) js = js.replace(/=/g, "=\"") + '"';
	return js == "" ? 0 : eval(o + '.' + unescape(js.replace(/&/g, "\";" + o + '.')));
}

function D64(s)
{
	return s;
}

function fDiskRead(sIndex, sContents)
{
	aDSKs [sIndex] = sContents;
}

function fImage(n)
{
	for (var i = 0, f = 0; !f && i < aImages.length; ++i) f = aImages [i][0] == n;
	return "\"./img/" + aImages [f ? i-1 : 0] [1] + ".png\"";
}

function fLaunch(nDisk)
{
	document.location.href = "./" + (bLocal ? "index.html" : "") + "?disk0=" + nDisk + "&autoboot=2";
}

function fDownload(nDisk)
{
	//	data:application/octet-stream;base64,		OR		data:application/binary;base64,

	// This trick will generate a temp <a /> tag, ...
	var eLink = document.createElement('a');
//	eLink.href = "data:application/octet-stream;base64," + window.btoa(fPad(window.atob(aDSKs [nDisk]), String.fromCharCode(0), 256 * 10 * 40));
//	eLink.href = "data:application/octet-stream;base64," + fDisk(aDSKs [nDisk]);
	eLink.href = "data:application/octet-stream;base64," + aDSKs [nDisk];

	// ... set the visibility hidden so it will not effect the page layout, ...
	eLink.style = "visibility: hidden;";
	eLink.download = "Disk" + nDisk + ".dsk"

	// ... append the anchor tag and remove it after automatic click
	document.body.appendChild(eLink);
	eLink.click();
	document.body.removeChild(eLink);
}

function fDisk(s)
{
	var c = String.fromCharCode(0), i = (s = window.atob(s)).length, n = 256 * 10 * 40;
	for (; i < n; ++i) s += c; return window.btoa(s);
}

function fPad(s, c, n)
{
	for (var i = s.length; i < n; ++i) s += c;
	return s;
}

function fWrite(s)
{
	document.write(s);
}

VARG_get("ARGV");

var c, f, i, l, n, r, s, t = "Click here to ";

for (i = 0, r = 0; i < aDisks.length; ++i) {
	for (f = false, n = 0; !f && n < aData.length; ++n) f = aData [n][0]*1 == aDisks [i]; --n;
	if (f) {
		sImage		= fImage(aData [n][0]);
		sRecordNr	= aData [n][0];
		sPublisher	= aData [n][2];
		sType		= aData [n][5];
		sTitle		= aData [n][6];

		fWrite((r++ % 4 ? "" : "<tr>") + "<th><div style = \"display: inline-block; width: 280px; height: 420px; background-color: #666; margin: 4px;\">");
		fWrite("<img src = " + sImage + " width = \"256px\">");
		fWrite("<table style = \"width: 100%; height: 70px\"><tr><th><h1>" + sTitle.toUpperCase() + "</h1></th></tr></table>");
		fWrite("<h2>" + sPublisher.toUpperCase() + "</h2>");
		fWrite("<h2>" + sType.toUpperCase() + "</h2>");
		fWrite("<button onclick = \"fDownload(" + aData [n][0] + ")\" title = \"" + t + "download this game\">DOWNLOAD</button>&nbsp;&nbsp;&nbsp;");
		fWrite("<button onclick = \"fLaunch(" + aData [n][0] + ")\" title = \"" + t + "play this game\">PLAY</button>");
		fWrite("<h2>RECORD NUMBER: " + sRecordNr + "</h2>");
		fWrite("</div></th>" + (r % 4 ? "" : "</tr>")); } }

				// -->

			</script>
			<script type = "text/javascript" language = "JavaScript" src = "./archive.js"></script>
		</table>
	</body>
</html>
